## 状态改变

现在你的面前有一份PS文件，你需要把它转换为HTML和CSS（可能会有一些JavaScript在里面）。

从构图到实现代码似乎很简单。但是，页面中的各种组件需要被呈现各种状态，默认状态应该是什么样以及状态改变时的外观又是什么样。

### 什么是状态改变？

改变状态有三种方式：

1. 类名
2. 伪类
3. 媒体查询

**类名**导致的状态变化往往和JavaScript相关。通过一些交互，例如移动鼠标，敲击键盘或者是其他什么事件，一个元素会被添加一个新的类，然后出现不同的视觉效果。

数量众多的**伪类**也可以对状态进行改变。使用**伪类**我们就不需要使用JavaScript来描述状态的变化。不过，**伪类**的应用是有限的，它只能改变伪类所在元素的后代或者兄弟元素。不然，我们就只能去使用JavaScript。

而**媒体查询**则定义了在固定标准（例如不同的视口大小）下的样式规则。

对于基于模块的系统，考虑每个模块基于状态的设计是十分重要的。当你不同问自己，“默认状态是怎么的？”，你会发现自己会去主动思考如何逐渐改进现有的设计，这也会让你处理问题的方式略微不同。


### 通过类名改变

大多数情况下，类名的改变是比较简单的。它适用于所有需要展示不同状态的元素。例如，用户点击一个图标来隐藏和显示元素。
```javascript
/* 通过类名JavaScript改变了状态 */
// with jQuery
$('.btn-close').click(function(){ 
    $(this).parents('.dialog').addClass('is-hidden');        
})
```

上述的jQuery例子为每个有`btn-close`类名的元素添加了一个点击的事件。当用户点击按钮的时候，JavaScript会传递事件并在DOM树上找到带有`dialog`类的祖先元素，然后将`is-hidden`的状态类添加到该元素上。

状态改变的影响远不止这样。

一个比较通用的用户设计模式是按钮被点击然后显示一个菜单，按钮变为按下状态，菜单变为显示状态。我们如何处理这种状态变化呢？这得看你的HTML结构。例如，在雅虎，菜单会在按钮点击之后被加载，然后将菜单的HTML结构插入DOM当中，并通过命名约定将两者绑定在一起。

```html
<!-- 按钮和菜单在同一文档的不同部分 -->
<div id="content">
   <div class="toolbar">
      <button id="btn-new" class="btn" data-action="menu">New</button>
   </div>
</div>
<div id="menu-new" class="menu">
   <ul> ... </ul>
</div>
```

`data-action`这个属性会在JavaScript的点击处理过程中告诉程序：“你好，我要加载一个菜单”。接着程序会获取按钮ID，并找到相应的菜单。下面是模拟这个效果的jQuery代码：

```javascript
/* 使用jQuery加载菜单 */
// bind a click handler to the button
$('#btn-new').click(function(){
    // wrap the clicked button in jQuery
    var el = $(this); 

    // change the state of the button
    el.addClass('is-pressed');

    // find the menu by stripping btn- and
    // adding it to menu selector
    $('#menu-' + el.id.substr(4)).removeClass('is-hidden');
});
```

如上述代码所示，通过JavaScript，单个元素的状态更改可以使得在两个不同地方的元素改变。

但是如果菜单在按钮的旁边呢？

```html
<!-- 按钮和菜单在文档的相同部分 -->

<div id="content">
   <div class="toolbar">
      <button id="btn-new" class="btn" data-action="menu">New</button>
      <div id="menu-new" class="menu">
          <ul> ... </ul>
      </div>
   </div>
</div>

```
之前的代码还是可以起作用，完全可以保留不变。但是，我们可以有其他选择。你的第一直觉可能是在父元素上添加一个类，并为按钮和菜单编写样式。

```html
<!-- 在父元素上添加类，并为其子元素编写样式 -->
<div id="content">
   <div class="toolbar is-active">
      <button id="btn-new" class="btn" data-action="menu">New</button>
      <div id="menu-new" class="menu">
          <ul> ... </ul>
      </div>
   </div>
</div>

/* CSS for styling */

.is-active .btn { color: #000; }
.is-active .menu { display: block; }
```
这个方法的问题是HTML结构被绑定在一起，且必须要有一个容器元素。菜单和按钮必须存在于容器元素中，这使得我们只能寄希望于在工具栏上不会再添加新的按钮了。

另一种方法就是像我们之前做的一样，在按钮上添加`active`类，然后使用兄弟选择器去激活菜单。

```html
<!-- 用兄弟选择器去激活菜单 -->
<div id="content">
   <div class="toolbar">
      <button id="btn-new" class="btn is-active" data-action="menu">New</button>
      <div id="menu-new" class="menu">
          <ul> ... </ul>
      </div>
   </div>
</div>

/* CSS for styling */

.btn.is-active { color: #000; }
.btn.is-active + .menu { display: block; }
```

我更喜欢使用这个方法而不是把状态类加在父元素上，这样能够让状态和模块更紧密地联系起来。而且菜单和按钮的HTML仍然存在依赖性：一个元素必须紧接着另一个元素。不过，这个方法能够在你的项目建立一致性，那这就是一个可以为你所用的好方法。

#### 为什么在父元素和兄弟元素上标注状态都是有问题的？

这些方法之所以会在应用于模块时出现问题，就是因为我们已经不知道应该在哪里找到相应的规则集。菜单不在只是菜单，它变成了一个按钮菜单。如果你需要改变这个模块的`active`状态，你是应该在按钮样式中找还是在菜单样式中找呢？

所有这一切告诉我们，为每个按钮分配不同的状态才是更好的选择。这可以使得模块之间的耦合度降低，使你的网站更容易测试，开发，扩展。


### 使用属性选择器改变状态





